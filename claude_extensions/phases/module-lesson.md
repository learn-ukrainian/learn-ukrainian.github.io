# Phase 3: module-lesson

Generate main lesson content from locked meta.yaml.

## Usage

```
/module-lesson {level} {module_num}
```

## Input

- `curriculum/l2-uk-en/{level}/meta/{slug}.yaml` (LOCKED from Phase 2)

## Output

- `curriculum/l2-uk-en/{level}/{slug}.md`

## Step 0: Hydration Pre-Check (CRITICAL)

Before generating ANY content, verify the metadata is fully hydrated:

```bash
slug=$(yq ".levels.\"{level}\".modules[{num-1}]" curriculum/l2-uk-en/curriculum.yaml) # Or file detection
if [ ! -f "curriculum/l2-uk-en/{level}/meta/${slug}.yaml" ] || ! grep -q "content_outline:" "curriculum/l2-uk-en/{level}/meta/${slug}.yaml"; then
  echo "ERROR: Missing hydrated outline. Run /module-meta then /architect first."
  exit 1
fi
```

**If this check fails, STOP immediately.**

## Critical Rules

> [!IMPORTANT]
>
> ### Word Count Accuracy
>
> The PRIMARY goal of this phase is hitting the **total word target**.
>
> **Priority hierarchy:**
> 1. **Total word count** ‚â• `word_target` (MOST IMPORTANT)
> 2. Individual sections within ¬±10% of target (flexible guidance)
>
> **Section targets are FLEXIBLE:**
> - You can redistribute words between sections
> - One section can be 20% over if another is 5% under
> - As long as total ‚â• word_target and no section >10% under
> - See: `docs/SUBSECTION-FLEXIBILITY-GUIDE.md` for examples
>
> **Process:**
>
> 1. Generate each section independently
> 2. Count words after EACH section
> 3. Adjust if needed BEFORE moving to next section
> 4. Final check: **total must be ‚â•95% of word_target**
> 5. Sections >10% under target? Expand OR redistribute from over-sections
>
> **Why this matters:**
>
> - LLMs struggle with overall word counts
> - Section-by-section generation with verification ensures accuracy
> - This is the ONLY way to reliably hit 4000+ word targets
>
> ### Content-Only Scope
>
> Generate ONLY main lesson content. DO NOT generate:
>
> - ‚ùå Activities (essays, quizzes, exercises) ‚Üí Phase 5
> - ‚ùå Vocabulary tables ‚Üí Phase 7
> - ‚ùå Practice recommendations ‚Üí auto-generated by script
> - ‚úì Main narrative/explanation
> - ‚úì Examples within text
> - ‚úì Engagement boxes
> - ‚úì Primary source excerpts (for history modules)
>
> ### Vocabulary Usage
>
> Use ONLY vocabulary from `vocabulary_hints`:
>
> - **required**: MUST appear in content
> - **recommended**: MAY appear if contextually appropriate
>
> DO NOT add vocabulary outside these lists. Vocabulary scope is pre-planned.

---

## Content Generation Process

### Step 1: Load Meta and Template

1. Read meta.yaml:

   ```bash
   curriculum/l2-uk-en/{level}/meta/{slug}.yaml
   ```

2. Read appropriate template:
   - **A1**: `docs/l2-uk-en/templates/a1-module-template.md`
   - **A2**: `docs/l2-uk-en/templates/a2-module-template.md`
   - **B1**: `docs/l2-uk-en/templates/b1-grammar-module-template.md` (or cultural/vocabulary based on focus)
   - **B2 core**: `docs/l2-uk-en/templates/b2-grammar-module-template.md` (or others)
   - **B2-HIST**: `docs/l2-uk-en/templates/ai/b2-history-module-template.md`
   - **B2-PRO**: `docs/l2-uk-en/templates/ai/b2-pro-module-template.md`
   - **C1-BIO**: `docs/l2-uk-en/templates/ai/c1-biography-module-template.md`
   - **C1-HIST**: `docs/l2-uk-en/templates/ai/c1-history-module-template.md`
   - **C1-PRO**: `docs/l2-uk-en/templates/ai/c1-pro-module-template.md`
   - **LIT**: `docs/l2-uk-en/templates/ai/lit-module-template.md`

3. Read quality standards:
   ```
   docs/l2-uk-en/MODULE-RICHNESS-GUIDELINES-v2.md
   ```

### Step 2: Generate SCOPE Comment

For all modules, start with SCOPE comment (NO frontmatter - metadata is in meta.yaml):

```markdown
<!-- SCOPE
Covers: [What this module teaches - from objectives]
Not covered:
  - [Related topic] ‚Üí {slug}
  - [Related topic] ‚Üí {slug}
Related: [connected slugs from meta.connects_to]
-->
```

### Step 3: Generate Title and Introduction

**Title (H1):**

```markdown
# {title from meta}
```

**Introduction Hook (optional but recommended for B1+):**

Based on pedagogy and focus:

**For history/cultural modules (B2+):**

```markdown
> **–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?**
>
> [2-3 sentences explaining historical/cultural significance]
> [Connection to modern Ukraine or learner's context]
```

**For grammar modules:**

```markdown
> **üéØ –ú–µ—Ç–∞ –º–æ–¥—É–ª—è**
>
> [What learner will be able to do after this lesson]
```

### Step 4: Generate Content Sections

**CRITICAL: Section-by-section generation with word count verification**

For each section in `content_outline`:

1. **Read section requirements:**
   - `section`: Ukrainian heading
   - `words`: Target word count
   - `points`: Key points to cover

2. **Generate section content:**

   ```markdown
   ## {section name}

   [Content covering all points, hitting word target]
   ```

3. **Apply level-specific requirements:**

   **Engagement Boxes** (from MODULE-RICHNESS-GUIDELINES-v2.md):
   - A1: 3+ per module
   - A2: 4+ per module
   - B1: 5+ per module
   - B2: 6+ per module
   - C1: 7+ per module
   - C2: 8+ per module

   Use callout types based on content:
   - `[!tip]` - Grammar tips, learning strategies
   - `[!history-bite]` - Historical facts (history modules)
   - `[!myth-buster]` - Decolonization content (history modules)
   - `[!culture]` - Cultural context
   - `[!quote]` - Primary sources (history modules)
   - `[!warning]` - Common mistakes

   **Example Sentences** (from MODULE-RICHNESS-GUIDELINES-v2.md):
   - A1: 12+ per module
   - A2: 18+ per module
   - B1: 24+ per module
   - B2: 24+ per module
   - C1: 30+ per module
   - C2: 32+ per module

   Format:

   ```markdown
   _–ü—Ä–∏–∫–ª–∞–¥:_ ¬´{Ukrainian sentence}¬ª
   ```

   **Mini-Dialogues** (for grammar/vocab modules, NOT history):
   - A1: 2+ per module
   - A2: 3+ per module
   - B1: 4+ per module
   - B2: 4+ per module
   - C1: 5+ per module
   - C2: 5+ per module

   Format:

   ```markdown
   **–î—ñ–∞–ª–æ–≥:**

   - –ê: {line}
   - –ë: {line}
   ```

4. **Count words immediately:**

   ```
   Section actual: {count} words
   Section target: {words} words
   Difference: {count - words}
   ```

5. **Adjust if needed:**
   - If under target: Expand with more examples, context, or detail
   - If over target: Tighten prose or move content to next section
   - Goal: ¬±10% of section target

6. **Move to next section** only after current section is accurate

### Step 5: Generate Summary

After all content sections, add summary:

```markdown
---
# –ü—ñ–¥—Å—É–º–æ–∫

[3-4 paragraph summary covering: - Main topic reviewed
    - Key grammar/vocabulary/concepts learned
    - Connection to broader context
    - Next steps or related topics]
---
```

**Summary word count:** ~150-200 words (NOT counted toward word_target)

### Step 6: Verify Total Word Count

**Final check:**

```
Total content words: {sum of all section words}
Target: {word_target}
Percentage: {(total/target) * 100}%
Status: PASS if 95-105% of target
```

If outside range: Adjust largest section(s) to compensate.

---

## Pedagogy-Specific Content Patterns

### PPP (Presentation-Practice-Production)

**Used in:** A1-A2 grammar modules

**Content structure:**

- **Warm-up/Presentation:** Introduce concept with context
- **Examples:** Show pattern with multiple examples
- **Explanation:** Grammar rule in simple terms
- **Practice:** Guided examples (activities go in Phase 5)

**Immersion:**

- A1: 10-40% Ukrainian (graduated)
- A2: 40-75% Ukrainian (graduated by phase)

### TTT (Test-Teach-Test)

**Used in:** A2-B1 grammar modules

**Content structure:**

- **Diagnostic:** Start with challenge to reveal gap
- **Analysis:** Examine the grammar problem
- **Deep Dive:** Detailed explanation with examples
- **Grammar in Context:** Show natural usage

**Immersion:**

- B1+: 100% Ukrainian

### Seminar (Content-Based)

**Used in:** B2-HIST, C1-BIO, C1-HIST, LIT

**Content structure:**

- **–í—Å—Ç—É–ø:** Context and significance
- **–ß–∏—Ç–∞–Ω–Ω—è:** Extended narrative (500+ words for history)
- **–ü–µ—Ä–≤–∏–Ω–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞:** Primary source excerpts with analysis
- **–ê–Ω–∞–ª—ñ–∑/–û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è:** Critical analysis section
- **–î–µ–∫–æ–ª–æ–Ω—ñ–∑–∞—Ü—ñ–π–Ω–∏–π –ø–æ–≥–ª—è–¥:** Ukraine-centric perspective (history only)

**Special requirements:**

- Minimum 2 primary sources in `[!quote]` callouts
- Extended paragraphs (100-200 words each)
- Academic register
- Source citations

**Immersion:** 100% Ukrainian

### CLIL (Content and Language Integrated)

**Used in:** B1 cultural modules

**Content structure:**

- **Introduction:** Topic overview
- **Narrative:** Cultural content
- **Grammar in Context:** Show grammar naturally in content
- **Cultural Analysis:** Deeper understanding

**Immersion:** 100% Ukrainian

---

## Level-Specific Guidelines

### A1 Modules

**Word Target:** 300-750 (graduated)

- M01-05: 300-450 words
- M06-10: 500-650 words
- M11-34: 750+ words

**Immersion:** 10-40% (graduated)

- Heavy English for phonetics, explanations
- Ukrainian for examples being taught

**Content focus:**

- Clear phonetic explanations
- Letter/sound relationships
- International words
- Simple vocabulary presentation

**Objectives language:** English

- "Learner can recognize..."
- "Learner can pronounce..."

### A2 Modules

**Word Target:** 1000-1500

**Immersion:** 40-75% (graduated)

- A2.1: 40-50%
- A2.2: 50-65%
- A2.3: 65-75%

**Content focus:**

- Case system introduction
- Aspect basics
- Practical scenarios

**Objectives language:** English

- "Learner can use..."
- "Learner can distinguish..."

### B1+ Modules

**Word Target:** 1500-2000 (core), higher for tracks

**Immersion:** 100% Ukrainian

- ALL content in Ukrainian
- Grammar explanations in Ukrainian
- Grammar metalanguage as vocabulary

**Content focus:**

- Complex grammar IN Ukrainian
- Cultural content
- Extended reading

**Objectives language:** Ukrainian

- "–£—á–µ–Ω—å –º–æ–∂–µ –æ–ø–∏—Å–∞—Ç–∏..."
- "–£—á–µ–Ω—å –º–æ–∂–µ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏..."

---

## Quality Standards

### Ukrainian Language Quality

1. **No Surzhyk:** Zero tolerance
2. **No Russian interference:** Check vocabulary against Goroh, –°–ª–æ–≤–Ω–∏–∫.ua
3. **Active voice:** Prefer active over passive constructions
4. **Natural flow:** No robotic transitions, no template repetition
5. **Discourse markers:** Use connectors (–∞, –∞–ª–µ, —Ç–æ–º—É, —Ç–∞–∫–æ–∂, —Å–ø–æ—á–∞—Ç–∫—É, –Ω–∞—Ä–µ—à—Ç—ñ)

### Naturalness (Write for 8+/10)

**As you write, aim for naturalness score ‚â•8/10.** You'll evaluate this yourself in module-lesson-qa.

**While generating content:**
- Vary sentence structures (don't start 3+ sentences the same way)
- Use discourse markers between ideas (–ø–æ—Ç—ñ–º, —Ç–æ–º—É, –∞–ª–µ, –∫—Ä—ñ–º —Ç–æ–≥–æ)
- Maintain topic coherence within paragraphs
- Avoid template patterns ("X —î Y. X —Ç–∞–∫–æ–∂ —î Z. X –º–∞—î W.")
- Use natural intensifiers sparingly (limit "–¥—É–∂–µ", avoid "–Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ")

**See:** `scripts/audit/ukrainian_naturalness_checker_prompt.md` for full criteria.

### Content Quality

1. **Accuracy:** All historical/cultural facts must be verifiable from sources
2. **Decolonization:** Ukraine-centric perspective (not Russian imperial framing)
3. **Engagement:** Use storytelling, not dry exposition
4. **Examples:** Diverse, realistic, culturally appropriate
5. **Grammar:** Demonstrate points naturally, not artificially

### Formatting

1. **Headings:** Use H2 (##) for main sections from content_outline
2. **Callouts:** Use `[!type]` format with proper types
3. **Emphasis:** Use **bold** for key terms, _italic_ for Ukrainian in English context
4. **Lists:** Use `-` for unordered, `1.` for ordered
5. **Horizontal rules:** Use `---` to separate major sections

---

## Output Format

**IMPORTANT:** NO frontmatter in .md files. Metadata lives in `meta/{slug}.yaml`.

```markdown
<!-- SCOPE
{scope comment}
-->

# {Title}

> {Introduction hook if appropriate}

## {Section 1 from content_outline}

{Content hitting section word target}

{Engagement boxes}
{Examples}
{Mini-dialogues if appropriate}

## {Section 2}

{Content...}

[... all sections from content_outline ...]

---

# –ü—ñ–¥—Å—É–º–æ–∫

{Summary}

---
```

---

## Validation Checklist

Before outputting, verify:

- [ ] All sections from content_outline generated
- [ ] Each section hits ¬±10% of word target
- [ ] Total word count is 95-105% of meta.word_target
- [ ] Engagement boxes meet level minimum
- [ ] Example sentences meet level minimum
- [ ] Mini-dialogues included (if grammar/vocab module)
- [ ] All required vocabulary used
- [ ] No vocabulary outside hints lists
- [ ] Grammar points demonstrated
- [ ] Immersion % matches level requirements
- [ ] Objectives language matches level (English A1-A2, Ukrainian B1+)
- [ ] No activities/exercises included (those are Phase 5)
- [ ] No vocabulary tables (those are Phase 7)
- [ ] NO frontmatter (metadata in meta.yaml)
- [ ] SCOPE comment present at start of file

---

## Next Phase

On completion, output:

```
LESSON GENERATED: curriculum/l2-uk-en/{level}/{slug}.md

Word count breakdown:
- Section 1: {count}/{target} words
- Section 2: {count}/{target} words
...
- Total: {total}/{word_target} words ({percentage}%)

‚úì Engagement boxes: {count} (min: {level_min})
‚úì Example sentences: {count} (min: {level_min})
‚úì Immersion: {percentage}% (target: {level_target})

Next: Run /module-lesson-qa {level} {module_num}
```

## Examples

### Example 1: B2-HIST Lesson Generation

**Input:** Locked `meta/trypillian-civilization.yaml` (see module-meta examples)

**Output:** `trypillian-civilization.md` (excerpt)

```markdown
<!-- SCOPE
Covers: –¢—Ä–∏–ø—ñ–ª—å—Å—å–∫–∞ –∫—É–ª—å—Ç—É—Ä–∞ —è–∫ –æ–¥–Ω–∞ –∑ –Ω–∞–π–¥–∞–≤–Ω—ñ—à–∏—Ö —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ–π –Ñ–≤—Ä–æ–ø–∏ ‚Äî —ñ—Å—Ç–æ—Ä—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è, –ø—Ä–æ—Ç–æ–º—ñ—Å—Ç–∞, –≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤–æ, —Ä–µ–º–µ—Å–ª–∞, –¥—É—Ö–æ–≤–Ω–∏–π —Å–≤—ñ—Ç
Not covered:
  - –°–∫—ñ—Ñ–∏ —Ç–∞ —Å–∞—Ä–º–∞—Ç–∏ ‚Üí scythians-sarmatians
  - –°–ª–æ–≤'—è–Ω—Å—å–∫—ñ –ø–ª–µ–º–µ–Ω–∞ ‚Üí sloviany-origins
  - –°–∏–Ω—Ç–µ–∑ —Ñ–∞–∑–∏ –í–∏—Ç–æ–∫–∏ ‚Üí syntez-vytoky-1
Related: scythians-sarmatians, sloviany-origins, syntez-vytoky-1
-->

# –¢—Ä–∏–ø—ñ–ª—å—Å—å–∫–∞ —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—è

> **–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?**
>
> –¢—Ä–∏–ø—ñ–ª—å—Å—å–∫–∞ –∫—É–ª—å—Ç—É—Ä–∞ ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∞—Ä—Ö–µ–æ–ª–æ–≥—ñ—á–Ω–∞ –∑–Ω–∞—Ö—ñ–¥–∫–∞. –¶–µ –¥–æ–∫–∞–∑ —Ç–æ–≥–æ, —â–æ –Ω–∞ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó —Å—É—á–∞—Å–Ω–æ—ó –£–∫—Ä–∞—ó–Ω–∏ —ñ—Å–Ω—É–≤–∞–ª–∞ –æ–¥–Ω–∞ –∑ –Ω–∞–π—Ä–æ–∑–≤–∏–Ω–µ–Ω—ñ—à–∏—Ö —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ–π –Ñ–≤—Ä–æ–ø–∏ —â–µ –∑–∞ —Ç–∏—Å—è—á–æ–ª—ñ—Ç—Ç—è –¥–æ –ø–æ—è–≤–∏ —î–≥–∏–ø–µ—Ç—Å—å–∫–∏—Ö –ø—ñ—Ä–∞–º—ñ–¥.

## –í—Å—Ç—É–ø

–¢—Ä–∏–ø—ñ–ª—å—Å—å–∫–∞ –∫—É–ª—å—Ç—É—Ä–∞ ‚Äî —Ü–µ –æ–¥–Ω–∞ –∑ –Ω–∞–π—è—Å–∫—Ä–∞–≤—ñ—à–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –ø—Ä–∞–¥–∞–≤–Ω—å–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó –£–∫—Ä–∞—ó–Ω–∏... [500 words]

[!history-bite] –ê—Ä—Ö–µ–æ–ª–æ–≥—ñ—á–Ω–∞ –¥–∞–≤–Ω—ñ—Å—Ç—å
–ê—Ä—Ö–µ–æ–ª–æ–≥—ñ—á–Ω—ñ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é—Ç—å, —â–æ –ø–æ—Å–µ–ª–µ–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ —Å—É—á–∞—Å–Ω–æ–≥–æ –ö–∏—î–≤–∞ —ñ—Å–Ω—É–≤–∞–ª–æ —â–µ –≤ –∫–∞–º'—è–Ω—É –¥–æ–±—É ‚Äî –ø–æ–Ω–∞–¥ 20 000 —Ä–æ–∫—ñ–≤ —Ç–æ–º—É!

## –ß–∏—Ç–∞–Ω–Ω—è

–û–¥–Ω–∏–º —ñ–∑ –Ω–∞–π–≤—Ä–∞–∂–∞—é—á–∏—Ö –¥–æ—Å—è–≥–Ω–µ–Ω—å –¢—Ä–∏–ø—ñ–ª–ª—è —î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ–º—ñ—Å—Ç... [2000 words]

_–ü—Ä–∏–∫–ª–∞–¥:_ ¬´–¢—Ä–∏–ø—ñ–ª—å—Ü—ñ –±—É–¥—É–≤–∞–ª–∏ –¥–≤–æ–ø–æ–≤–µ—Ä—Ö–æ–≤—ñ –±—É–¥–∏–Ω–∫–∏ –∑ –≥–ª–∏–Ω–∏.¬ª

---

# –ü—ñ–¥—Å—É–º–æ–∫

–¢—Ä–∏–ø—ñ–ª—å—Å—å–∫–∞ —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—è –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≥–ª–∏–±–æ–∫—ñ –∫–æ—Ä–µ–Ω—ñ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ—ó... [200 words]

---
```

**Word count breakdown:**

- –í—Å—Ç—É–ø: 500/500 words
- –ß–∏—Ç–∞–Ω–Ω—è: 2000/2000 words
- –ü—ñ–¥—Å—É–º–æ–∫: 200/200 words (not counted in target)
- Total: 2700/2500 words (108%)

### Example 2: A1 Lesson Generation

**Input:** A1 meta with 300 word target

**Output:** Basic lesson with heavy English scaffolding

```markdown
# The Cyrillic Code I

Welcome to Ukrainian! Today you learn 19 letters...

## Presentation

Here are the True Friends... [150 words]

[!tip] Remember: –í looks like B but sounds like V

_Example:_ "Mama"

## Practice

Try reading these words... [100 words]

---

# Summary

You learned 19 letters... [50 words]
```

**Word count:** 300/300 (100%)

---

**Phase output is UNLOCKED until Phase 4 QA passes.**
