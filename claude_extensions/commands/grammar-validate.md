# /grammar-validate

Cross-agent grammar validation for Ukrainian curriculum content.

## Usage

```
/grammar-validate <module-path>
/grammar-validate curriculum/l2-uk-en/b1/17-motion-coming-going.md
/grammar-validate b1/17  # Shorthand
```

## Purpose

Validate grammar in `.grammar-queue.yaml` files generated by the audit system. This skill embeds the Ukrainian Grammar Validator rules to ensure consistent, accurate validation.

**Workflow position:**
```
/module-create → /grammar-validate → /review-content → /module-stage-4
```

## Instructions

### Step 1: Locate Queue File

Find the `.grammar-queue.yaml` file for the specified module:
```
curriculum/l2-uk-en/{level}/{module}.grammar-queue.yaml
```

If no queue file exists, run the generator:
```bash
.venv/bin/python scripts/generate_grammar_queue.py {module.md}
```

### Step 2: Read Queue

Load the YAML queue file. Each item has this structure:

```yaml
items:
  - activity: error-correction
    title: "Activity title"
    sentence_with_error: "Я прийшов до Львова потягом."
    error: "прийшов"
    answer: "приїхав"
    sentence_corrected: "Я приїхав до Львова потягом."
    validate:
      error_is_real_mistake: null      # You fill this
      corrected_sentence_valid: null   # You fill this
      explanation: null                # You fill this
      confidence: null                 # You fill this
```

### Step 3: Validate Each Item

For each item, apply the Grammar Validator rules below:

#### 3a. Validate the ERROR is a real mistake

Check if `sentence_with_error` contains a genuine error:

**Real errors (flag as `error_is_real_mistake: true`):**
- Russianisms: кушать, ложить, кто, что
- Surzhyk: mixed Ukrainian-Russian grammar
- Case errors: wrong case after verb/preposition
- Agreement errors: gender/case/number mismatch
- Calques: "робити сенс" (make sense)
- Aspect errors: wrong aspect for context
- Spelling: non-existent words

**NOT real errors (flag as `error_is_real_mistake: false`):**
- Pedagogical simplifications appropriate for the level
- Style/register differences (both forms acceptable)
- Regional variations (both standard Ukrainian)

#### 3b. Validate the CORRECTED sentence is valid

Check if `sentence_corrected` is grammatically correct:

**Valid (`corrected_sentence_valid: true`):**
- Grammatically correct Ukrainian
- Natural word order
- Appropriate for the level
- No Russianisms/calques

**Invalid (`corrected_sentence_valid: false`):**
- Contains grammar errors
- Unnatural/awkward phrasing
- Contains Russianisms or calques
- Wrong case/aspect/agreement

### Step 4: Write Results

Update the `validate` fields and save to `.grammar-validated.yaml`:

```yaml
validate:
  error_is_real_mistake: true
  corrected_sentence_valid: true
  explanation: "«Прийшов» неправильно для транспорту. «Приїхав» (з префіксом при-) вживається для прибуття транспортом."
  confidence: 0.95
```

---

## Grammar Validator Rules (Embedded)

### Core Principles

1. **No Russianisms/Surzhyk** - Always flag:
   - кушать → їсти
   - ложить → класти
   - кто/что → хто/що
   - Mixed grammar patterns

2. **No Calques** - Flag English loan translations:
   - "робити сенс" → "мати сенс"
   - "приймати рішення" is OK (established)
   - "брати участь" is OK (established)

3. **Case Government** - Verify correct cases:
   - дати + dative (кому?)
   - бачити + accusative (кого? що?)
   - допомагати + dative (кому?)
   - After prepositions: check required case

4. **Aspect Correctness** - Check context:
   - Single completed action → perfective
   - Repeated/ongoing → imperfective
   - Negation often → imperfective
   - Future intentions → usually perfective

5. **Motion Verb Prefixes** - For B1 motion modules:
   - при- = arrival (приїхати, прийти)
   - ви- = departure (виїхати, вийти)
   - пере- = crossing (перейти, переїхати)
   - про- = passing through (пройти, проїхати)
   - за- = stopping by (зайти, заїхати)
   - об- = going around (обійти, об'їхати)

### Level-Aware Validation

**A1-A2 (Allow pedagogical simplifications):**
- Explicit copula "є" in "Це є книга" - OK for teaching
- Analytic future "буду + infinitive" - OK for teaching
- Simple word order - OK for beginners

**B1-B2 (Expect natural grammar):**
- Full aspect system
- Correct motion verb prefixes
- Natural word order
- Correct case government

**C1-C2 (Demand native-like accuracy):**
- Stylistic nuances
- Register appropriateness
- Idiomatic expressions

### Error Type Taxonomy

When flagging errors, categorize:
- `russianism` - Russian borrowing
- `surzhyk` - Mixed Ukrainian-Russian
- `calque` - English loan translation
- `case_error` - Wrong case
- `aspect_error` - Wrong aspect
- `agreement` - Gender/number mismatch
- `prefix_error` - Wrong motion verb prefix
- `spelling` - Non-existent word
- `word_order` - Ungrammatical order

### Confidence Levels

- **1.0** - Absolutely certain (clear Russianism, obvious case error)
- **0.9** - Very confident (standard grammar rules)
- **0.8** - Confident (context-dependent but clear)
- **0.7** - Somewhat confident (could be style choice)
- **< 0.7** - Flag for human review

---

## Output Format

Save validated results to `{module}.grammar-validated.yaml`:

```yaml
module: 17-motion-coming-going
level: B1
validated: 2025-12-27T15:30:00
validator: claude-cross-agent
summary:
  total_items: 6
  errors_confirmed: 5
  errors_rejected: 1
  needs_review: 0

items:
  - activity: error-correction
    title: "Помилки з префіксами"
    sentence_with_error: "Я прийшов до Львова потягом."
    error: "прийшов"
    answer: "приїхав"
    sentence_corrected: "Я приїхав до Львова потягом."
    validate:
      error_is_real_mistake: true
      corrected_sentence_valid: true
      explanation: "«Прийшов» (пішки) неправильно для подорожі потягом. «Приїхав» вживається для прибуття транспортом."
      confidence: 0.95
      error_type: prefix_error
```

---

## Example Validation Session

**Input (from queue):**
```yaml
- sentence_with_error: "Я кушаю яблуко."
  error: "кушаю"
  answer: "їм"
  sentence_corrected: "Я їм яблуко."
```

**Validation thinking:**
1. "кушаю" - Is this a real error?
   - Yes! "кушать" is a Russianism, not Ukrainian
   - Ukrainian: "їсти" (to eat)
   - `error_is_real_mistake: true`

2. "Я їм яблуко" - Is this valid?
   - Yes, grammatically correct
   - Natural Ukrainian
   - `corrected_sentence_valid: true`

**Output:**
```yaml
validate:
  error_is_real_mistake: true
  corrected_sentence_valid: true
  explanation: "«Кушати» — русизм. Правильно: «їсти» (НДВ) або «з'їсти» (ДВ)."
  confidence: 1.0
  error_type: russianism
```

---

## Checklist

Before completing validation:

- [ ] All items in queue have been validated
- [ ] Each item has all `validate` fields filled
- [ ] Explanations are in Ukrainian
- [ ] Confidence scores assigned
- [ ] Error types categorized
- [ ] Summary statistics calculated
- [ ] Output saved to `.grammar-validated.yaml`
