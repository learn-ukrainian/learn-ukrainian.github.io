
import yaml
import os

# Specific short prompt replacements
replacements = {
    # M16
    "Яка форма звертання є найбільш формальною?": "Яка із запропонованих форм звертання є найбільш офіційною та формальною в українській мові?",
    "Яке привітання є формальним?": "Яке з наведених привітань вважається найбільш формальним і доречним у діловому спілкуванні?",
    "Яке прощання є неформальним?": "Яке з наведених прощань є неформальним і використовується переважно у спілкуванні з друзями?",
    "Яка форма подяки є найбільш офіційною?": "Яка з наведених форм вираження вдячності є найбільш офіційною та шанобливою?",
    "У якому відмінку стоїть слово «пане» у звертанні «Пане директоре»?": "У якому граматичному відмінку стоїть слово «пане» у формальному звертанні «Пане директоре»?",
    "Що означає «перейти на ти»?": "Що саме означає вираз «перейти на ти» у контексті мовного етикету?",
    "Яке звертання використовують до викладача?": "Яке звертання традиційно використовують в українській академічній культурі стосовно викладача?",
    
    # M17
    "Які звертання доречні на початку ділового листа?": "Які форми звертання є найбільш доречними та прийнятними на початку офіційного ділового листа?",
    "Які прощання доречні в офіційному листі?": "Які формули прощання є стилістично доречними для використання в офіційному діловому листуванні?",
    "Які форми подяки є формальними?": "Які з наведених форм вираження вдячності належать до офіційно-ділового стилю?",
    
    # M18
    "Яка головна характеристика наукового стилю української мови?": "Яка риса є головною та визначальною характеристикою наукового стилю сучасної української мови?",
    "Яка конструкція типова для наукового стилю?": "Яка з наведених синтаксичних конструкцій є найбільш типовою для текстів наукового стилю?",
    "Що таке «анотація» наукової статті?": "Дайте визначення: що саме означає термін «анотація» в контексті наукової статті?",
    "Чому важливо використовувати посилання в наукових текстах?": "Чому в наукових текстах принципово важливо використовувати коректні посилання на першоджерела?",
    "Що означає термін «методологія» в науковому дослідженні?": "Що саме означає термін «методологія» в контексті проведення наукового дослідження?",
    
    # M19
    "Яка граматична конструкція є найхарактернішою ознакою офіційно-ділового стилю?": "Яка граматична конструкція є найхарактернішою та найбільш вживаною ознакою офіційно-ділового стилю?",
    "Який прийменник вживається з «відповідно»?": "Який прийменник правильно вживається зі словом «відповідно» в офіційно-діловому стилі?",
    "Який прийменник вживається з «згідно»?": "Який прийменник граматично правильно вживається зі словом «згідно» в українській мові?",
    "Який документ фіксує хід засідання?": "Який офіційний документ фіксує хід обговорення та прийняті рішення під час засідання?",
    "Яка формула використовується на початку заяви?": "Яка стандартна мовна формула зазвичай використовується на початку тексту офіційної заяви?",
    "Яке скорочення означає «місце печатки»?": "Яке стандартне скорочення в офіційних документах позначає місце для печатки?",
    "Який документ видає глава держави?": "Який офіційний документ має право видавати глава держави (Президент України)?",
    "Як правильно оформити дату в офіційному документі?": "Як правильно оформити дату в офіційному документі згідно з чинними стандартами?",
    "Яке слово є формальним синонімом до «дати»?": "Яке слово є стилістично нейтральним та формальним синонімом до розмовного слова «дати»?",
    "Що означає конструкція «було прийнято»?": "Що саме підкреслює пасивна безособова конструкція «було прийнято» в офіційному тексті?",
    
    # M20
    "Яке питання лікар зазвичай ставить на початку прийому?": "Яке стандартне запитання лікар зазвичай ставить пацієнту на самому початку медичного прийому?",
    "Що таке «профілактика»?": "Дайте визначення: що саме означає медичний термін «профілактика» захворювань?",
    "Що означає «здати аналізи»?": "Що саме означає вираз «здати аналізи» у контексті медичної діагностики?",
    "Яке слово означає «запалення легень»?": "Яке медичне слово (термін) означає захворювання «запалення легень»?",
    "Що означає «ліжковий режим»?": "Що саме означає медична рекомендація дотримуватися «ліжкового режиму»?"
}

def fix_morphemes(activity):
    if activity.get('title') in ["Знайдіть формальну лексику", "Знайдіть формальну ділову лексику", "Знайдіть медичні терміни"]:
        if 'correct_words' in activity:
            # Keep only first 10
            activity['correct_words'] = activity['correct_words'][:10]
            print(f"  Truncated morphemes for '{activity['title']}'")

def process_file(filepath):
    print(f"Processing {filepath}...")
    with open(filepath, 'r') as f:
        activities = yaml.safe_load(f)
    
    modified = False
    for act in activities:
        # Fix Morphemes
        if act.get('type') == 'mark-the-words':
            fix_morphemes(act)
            modified = True
            
        # Fix Prompts
        if act.get('type') in ['quiz', 'select']:
            for item in act.get('items', []):
                q = item.get('question', '')
                if q in replacements:
                    item['question'] = replacements[q]
                    modified = True
                # Partial match for robustness
                elif len(q.split()) < 10:
                    for k, v in replacements.items():
                        if k in q:
                            item['question'] = v
                            modified = True
                            break

    if modified:
        with open(filepath, 'w') as f:
            yaml.dump(activities, f, allow_unicode=True, sort_keys=False)
        print("  Updated.")

import glob
for i in range(16, 21):
    files = glob.glob(f"curriculum/l2-uk-en/b2/activities/{i}-*.yaml")
    for f in files:
        process_file(f)
